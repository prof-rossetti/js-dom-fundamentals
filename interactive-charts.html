<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Interactive Charts and Graphs | JavaScript DOM Fundamentals</title>
    <script src="http://code.highcharts.com/highcharts.js"></script>
  </head>
  <body>
    <h1><a href="index.html">JavaScript DOM Fundamentals</a></h1>

    <h2>Interactive Charts and Graphs</h2>

    <select id="year-selector">
      <option value="2015" selected=true>2015</option>
      <option value="2016">2016</option>
    </select>

    <div id="my-chart-container" style="width:100%; height:400px;"></div>

    <script type="text/javascript">

      // LISTEN FOR SELECTIONS

      var yearSelector = document.getElementById('year-selector')

      function selectYear() {
        console.log("SELECTED YEAR:", yearSelector.value)
        makeMyChart()
        // we could pass the year into the makeMyChart() function, like makeMyChart(yearSelector.value)
        // ... but we will instead just invoke the function witout passing a parameter...
        // ... and we will get the currently selected year from within the makeMyChart() function
        // ... we could do it either way.
      }

      yearSelector.addEventListener("change", selectYear, false)

      // MAKE A CHART HERE

      var browserShareByYear = {
        "2015": [
          {name: 'Microsoft Internet Explorer', y: 56.33},
          {name: 'Chrome', y: 24.03},
          {name: 'Firefox',y: 10.38},
          {name: 'Safari', y: 4.77},
          {name: 'Opera', y: 0.91},
          {name: 'Proprietary or Undetectable', y: 0.2}
        ],
        "2016": [
          {name: 'Microsoft Internet Explorer', y: 100},
          {name: 'Chrome', y: 25},
          {name: 'Firefox',y: 31},
          {name: 'Safari', y: 8},
          {name: 'Opera', y: 80},
          {name: 'Proprietary or Undetectable', y: 3}
        ]
      }

      function makeMyChart() {
        var selectedYear = yearSelector.value

        var chartConfigurationOptions = {
          chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
          },
          title: {
            text: 'Browser market shares for ' + selectedYear + " (fake data)" // concatenating strings here
          },
          tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
          },
          plotOptions: {
            pie: {
              allowPointSelect: true,
              cursor: 'pointer',
              dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                style: {
                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                }
              }
            }
          },
          series: [
            {
              name: 'Brands',
              colorByPoint: true,
              data: browserShareByYear[selectedYear]
           }
         ]
        }

        Highcharts.chart('my-chart-container', chartConfigurationOptions);
      }

      makeMyChart()

    </script>
  </body>
</html>
